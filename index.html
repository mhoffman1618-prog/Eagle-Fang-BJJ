<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0a">
<title>EagleFang BJJ ‚Äî Training Log</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

```
:root {
--red: #dc2626;
--red-dark: #991b1b;
--red-darkest: #7f1d1d;
--blue: #2563eb;
--blue-dark: #1d4ed8;
--green: #4ade80;
--green-bg: rgba(22, 101, 52, 0.3);
--green-border: rgba(34, 197, 94, 0.5);
--gray-100: #f5f5f5;
--gray-300: #d1d5db;
--gray-400: #9ca3af;
--gray-500: #6b7280;
--gray-600: #4b5563;
--gray-700: #374151;
--card-bg: linear-gradient(145deg, rgba(30, 30, 40, 0.9) 0%, rgba(20, 20, 30, 0.95) 100%);
--card-border: 1px solid rgba(220, 38, 38, 0.3);
--card-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255,255,255,0.05);
--input-bg: rgba(0, 0, 0, 0.4);
--input-border: 2px solid rgba(107, 114, 128, 0.3);
--input-border-sm: 1px solid rgba(107, 114, 128, 0.2);
}

body {
min-height: 100vh;
background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0f0f1a 100%);
font-family: 'Bebas Neue', 'Impact', sans-serif;
color: #e0e0e0;
overflow-x: hidden;
}

.bg-pattern {
position: fixed; inset: 0;
background-image:
radial-gradient(circle at 20% 80%, rgba(220, 38, 38, 0.1) 0%, transparent 50%),
radial-gradient(circle at 80% 20%, rgba(30, 58, 138, 0.15) 0%, transparent 50%),
repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,0.01) 35px, rgba(255,255,255,0.01) 70px);
pointer-events: none; z-index: 0;
}

/* Header */
header {
position: relative; z-index: 10;
padding: 20px 24px;
border-bottom: 3px solid var(--red);
background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 100%);
backdrop-filter: blur(10px);
}
.header-inner {
max-width: 1200px; margin: 0 auto;
display: flex; align-items: center; justify-content: space-between;
flex-wrap: wrap; gap: 16px;
}
.logo-group { display: flex; align-items: center; gap: 20px; }
.logo-box {
width: 70px; height: 70px;
background: linear-gradient(135deg, #1a1a2e 0%, #0a0a15 100%);
border-radius: 12px;
display: flex; align-items: center; justify-content: center;
box-shadow: 0 4px 20px rgba(220, 38, 38, 0.4), inset 0 0 20px rgba(220, 38, 38, 0.1);
border: 2px solid rgba(220, 38, 38, 0.5);
overflow: visible;
}
.title-text { font-size: 42px; font-weight: 400; letter-spacing: 4px; display: flex; gap: 16px; }
.title-eagle { background: linear-gradient(180deg, #fff 0%, #e5e5e5 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.title-fang { background: linear-gradient(180deg, #dc2626 0%, #991b1b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.title-bjj { background: linear-gradient(180deg, #9ca3af 0%, #6b7280 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 36px; }
.subtitle { font-size: 12px; letter-spacing: 6px; color: var(--gray-500); font-family: Arial, sans-serif; text-transform: uppercase; }

.nav-btns { display: flex; gap: 12px; }
.nav-btn {
padding: 12px 24px; font-size: 16px; letter-spacing: 2px;
border: 2px solid var(--gray-700); background: transparent;
color: var(--gray-400); cursor: pointer; border-radius: 8px;
transition: all 0.2s ease; font-family: 'Bebas Neue', sans-serif;
}
.nav-btn:hover { transform: translateY(-2px); }
.nav-btn.active { border-color: var(--red); background: rgba(220, 38, 38, 0.2); color: var(--red); }

/* Main */
main {
position: relative; z-index: 10;
max-width: 1200px; margin: 0 auto; padding: 32px 24px;
}

.card {
background: var(--card-bg); border-radius: 16px; padding: 24px;
border: var(--card-border); box-shadow: var(--card-shadow);
margin-bottom: 24px;
}
.card-label {
display: block; font-size: 14px; letter-spacing: 3px;
color: var(--red); margin-bottom: 12px; font-family: 'Bebas Neue', sans-serif;
}
.card-label-sm {
display: block; font-size: 12px; letter-spacing: 2px;
color: var(--gray-400); margin-bottom: 8px; font-family: 'Bebas Neue', sans-serif;
}

input[type="text"], input[type="date"], textarea {
width: 100%; padding: 14px 16px; font-size: 18px;
background: var(--input-bg); border: var(--input-border);
border-radius: 8px; color: #e0e0e0; outline: none;
font-family: Arial, sans-serif;
}
input::placeholder, textarea::placeholder { color: var(--gray-500); }
input:focus, textarea:focus { border-color: rgba(220, 38, 38, 0.5) !important; box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1); }
textarea { resize: vertical; line-height: 1.5; font-size: 15px; padding: 12px; }

.two-col { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 24px; }

.notes-inner {
background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 16px;
border: var(--input-border-sm); margin-top: 16px;
}

/* Rounds */
.round-item {
background: rgba(0, 0, 0, 0.3); border-radius: 12px;
border: var(--input-border-sm); overflow: hidden;
transition: all 0.2s ease; margin-bottom: 12px;
}
.round-item.expanded { background: rgba(220, 38, 38, 0.1); border-color: rgba(220, 38, 38, 0.4); }
.round-header {
width: 100%; padding: 16px 20px;
display: flex; align-items: center; justify-content: space-between;
background: transparent; border: none; cursor: pointer; color: #e0e0e0;
font-family: 'Bebas Neue', sans-serif;
}
.round-header:hover { opacity: 0.9; }
.round-num {
width: 36px; height: 36px; border-radius: 8px;
display: inline-flex; align-items: center; justify-content: center;
font-size: 18px; font-weight: bold; background: rgba(107, 114, 128, 0.3);
font-family: 'Bebas Neue', sans-serif;
}
.round-num.filled { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); }
.round-label { font-size: 18px; letter-spacing: 2px; margin-left: 12px; }
.round-partner { font-size: 14px; color: var(--gray-400); font-family: Arial, sans-serif; margin-left: 12px; }
.round-arrow { transition: transform 0.2s ease; font-size: 20px; }
.round-arrow.open { transform: rotate(180deg); }
.round-body { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 16px; }
.round-body input, .round-body textarea { border: var(--input-border-sm); font-size: 16px; padding: 12px 14px; }

/* Photo */
.photo-upload {
display: flex; flex-direction: column; align-items: center; justify-content: center;
padding: 40px; background: rgba(0, 0, 0, 0.3);
border: 2px dashed rgba(107, 114, 128, 0.4); border-radius: 12px;
cursor: pointer; transition: all 0.2s ease;
}
.photo-upload:hover { border-color: rgba(220, 38, 38, 0.5); }
.photo-upload span.icon { font-size: 48px; margin-bottom: 12px; }
.photo-upload span.text { font-size: 16px; color: var(--gray-400); font-family: Arial, sans-serif; }
.photo-preview { position: relative; }
.photo-preview img { width: 100%; max-height: 400px; object-fit: cover; border-radius: 12px; }
.photo-remove {
position: absolute; top: 12px; right: 12px;
width: 40px; height: 40px; background: rgba(220, 38, 38, 0.9);
border: none; border-radius: 8px; color: white; font-size: 20px;
cursor: pointer; display: flex; align-items: center; justify-content: center;
}

/* Buttons */
.btn-row { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }
.btn-save {
padding: 18px 48px; font-size: 20px; letter-spacing: 3px;
background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
border: none; border-radius: 12px; color: white; cursor: pointer;
font-family: 'Bebas Neue', sans-serif;
box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4); transition: all 0.2s ease;
}
.btn-save:hover { transform: translateY(-2px); }
.btn-save.editing { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4); }
.btn-clear {
padding: 18px 48px; font-size: 20px; letter-spacing: 3px;
background: transparent; border: 2px solid var(--gray-500);
border-radius: 12px; color: var(--gray-400); cursor: pointer;
font-family: 'Bebas Neue', sans-serif; transition: all 0.2s ease;
}
.btn-clear:hover { transform: translateY(-2px); }

/* History */
.history-title { font-size: 28px; letter-spacing: 4px; color: var(--red); margin-bottom: 24px; }
.empty-state {
text-align: center; padding: 60px;
background: rgba(30, 30, 40, 0.5); border-radius: 16px;
border: var(--input-border-sm);
}
.empty-state .icon { font-size: 64px; }
.empty-state p { font-size: 20px; color: var(--gray-500); margin-top: 16px; font-family: Arial, sans-serif; }

.history-card {
background: var(--card-bg); border-radius: 16px; padding: 20px 24px;
border: var(--card-border);
display: flex; align-items: center; justify-content: space-between;
flex-wrap: wrap; gap: 16px; margin-bottom: 16px;
}
.history-card .info { flex: 1; min-width: 200px; }
.history-card .date-text { font-size: 22px; letter-spacing: 2px; margin-bottom: 8px; }
.history-card .meta { font-size: 14px; color: var(--gray-400); font-family: Arial, sans-serif; }
.history-card .meta .label { color: var(--red); }
.history-card .meta .sep { margin: 0 12px; color: var(--gray-700); }
.history-card .actions { display: flex; gap: 12px; flex-wrap: wrap; }

.btn-view, .btn-edit, .btn-delete, .btn-back, .btn-edit-entry {
padding: 12px 24px; font-size: 14px; letter-spacing: 2px;
border-radius: 8px; cursor: pointer;
font-family: 'Bebas Neue', sans-serif; transition: all 0.2s ease;
}
.btn-view { background: rgba(30, 58, 138, 0.3); border: 1px solid rgba(59, 130, 246, 0.5); color: #60a5fa; }
.btn-edit { background: var(--green-bg); border: 1px solid var(--green-border); color: var(--green); }
.btn-delete { background: rgba(127, 29, 29, 0.3); border: 1px solid rgba(220, 38, 38, 0.5); color: #f87171; }
.btn-back { background: transparent; border: 1px solid var(--gray-500); color: var(--gray-400); font-size: 16px; letter-spacing: 2px; }
.btn-edit-entry { background: var(--green-bg); border: 1px solid var(--green-border); color: var(--green); font-size: 16px; letter-spacing: 2px; }
.btn-view:hover, .btn-edit:hover, .btn-delete:hover, .btn-back:hover, .btn-edit-entry:hover { transform: translateY(-2px); }

/* Edit banner */
.edit-banner {
background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.5);
border-radius: 12px; padding: 16px 24px; margin-bottom: 24px;
display: flex; align-items: center; justify-content: space-between;
flex-wrap: wrap; gap: 12px;
}
.edit-banner span { font-size: 18px; letter-spacing: 2px; color: #60a5fa; }
.edit-banner button {
padding: 8px 20px; font-size: 14px; letter-spacing: 2px;
background: transparent; border: 1px solid var(--gray-500);
border-radius: 8px; color: var(--gray-400); cursor: pointer;
font-family: 'Bebas Neue', sans-serif;
}

/* View detail */
.view-header-row { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
.view-card { background: var(--card-bg); border-radius: 16px; padding: 32px; border: var(--card-border); }
.view-date { font-size: 32px; letter-spacing: 4px; color: var(--red); margin-bottom: 8px; }
.view-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; margin-bottom: 32px; padding-bottom: 24px; border-bottom: var(--input-border-sm); }
.view-field-label { color: var(--gray-400); font-size: 12px; letter-spacing: 2px; }
.view-field-value { font-size: 20px; margin: 8px 0 0; font-family: Arial, sans-serif; }
.view-section-label { color: var(--red); font-size: 14px; letter-spacing: 2px; }
.view-notes-block {
font-size: 16px; margin: 12px 0 0; font-family: Arial, sans-serif;
line-height: 1.6; color: var(--gray-300);
background: rgba(0,0,0,0.2); padding: 16px; border-radius: 8px;
}
.view-round {
background: rgba(0, 0, 0, 0.3); border-radius: 12px;
padding: 16px 20px; border: var(--input-border-sm); margin-bottom: 12px;
}
.view-round-header { display: flex; align-items: center; gap: 12px; }
.view-round-num {
width: 32px; height: 32px;
background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
border-radius: 6px; display: inline-flex; align-items: center; justify-content: center;
font-size: 16px; font-family: 'Bebas Neue', sans-serif;
}
.view-round-partner { font-size: 18px; font-family: Arial, sans-serif; }
.view-round-notes { font-size: 15px; color: var(--gray-400); margin: 12px 0 0; padding-left: 44px; font-family: Arial, sans-serif; line-height: 1.5; }

.fade-in { animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.hidden { display: none !important; }

::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); }
::-webkit-scrollbar-thumb { background: rgba(220, 38, 38, 0.5); border-radius: 4px; }

@media (max-width: 600px) {
.title-text { font-size: 28px; gap: 8px; }
.title-bjj { font-size: 24px !important; }
.header-inner { gap: 12px; }
.logo-box { width: 50px; height: 50px; }
.logo-box svg { width: 42px; height: 42px; }
main { padding: 16px 12px; }
.card { padding: 16px; }
.btn-save, .btn-clear { padding: 14px 32px; font-size: 18px; }
.history-card .actions { width: 100%; }
.history-card .actions button { flex: 1; }
}
```

</style>
</head>
<body>

<div class="bg-pattern"></div>

<!-- Header -->

<header>
<div class="header-inner">
<div class="logo-group">
<div class="logo-box">
<svg viewBox="0 0 64 64" width="60" height="60" style="overflow:visible">
<defs>
<linearGradient id="headGradient" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#e5e5e5"/>
</linearGradient>
<linearGradient id="beakGradient" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/>
</linearGradient>
<linearGradient id="bloodGradient" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#dc2626"/><stop offset="100%" stop-color="#7f1d1d"/>
</linearGradient>
</defs>
<ellipse cx="32" cy="22" rx="18" ry="16" fill="url(#headGradient)"/>
<ellipse cx="26" cy="18" rx="6" ry="5" fill="#f5f5f5"/>
<ellipse cx="38" cy="18" rx="6" ry="5" fill="#f5f5f5"/>
<path d="M14 28 Q12 35 16 42 Q20 48 32 50 Q44 48 48 42 Q52 35 50 28 Q45 32 32 34 Q19 32 14 28Z" fill="#3d2914"/>
<ellipse cx="26" cy="20" rx="4" ry="3.5" fill="#1a1a1a"/>
<ellipse cx="38" cy="20" rx="4" ry="3.5" fill="#1a1a1a"/>
<ellipse cx="27" cy="19.5" rx="2" ry="1.8" fill="#fbbf24"/>
<ellipse cx="39" cy="19.5" rx="2" ry="1.8" fill="#fbbf24"/>
<circle cx="27.5" cy="19" r="1" fill="#000"/>
<circle cx="39.5" cy="19" r="1" fill="#000"/>
<path d="M22 16 L30 18" stroke="#5d4520" stroke-width="2" stroke-linecap="round"/>
<path d="M42 16 L34 18" stroke="#5d4520" stroke-width="2" stroke-linecap="round"/>
<path d="M28 26 Q32 24 36 26 Q38 28 40 32 Q38 30 32 32 Q26 30 24 32 Q26 28 28 26Z" fill="url(#beakGradient)"/>
<path d="M26 32 Q32 30 38 32 L40 36 Q38 38 32 40 Q26 38 24 36 Z" fill="url(#beakGradient)"/>
<path d="M27 32 L28 35 L29 32 L30 35 L31 32 L32 35 L33 32 L34 35 L35 32 L36 35 L37 32" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M28 36 L29 33.5 L30 36 L31 33.5 L32 36 L33 33.5 L34 36 L35 33.5 L36 36" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<ellipse cx="29" cy="42" rx="1.5" ry="3" fill="url(#bloodGradient)"/>
<ellipse cx="32" cy="44" rx="1.8" ry="4" fill="url(#bloodGradient)"/>
<ellipse cx="35" cy="41" rx="1.3" ry="2.5" fill="url(#bloodGradient)"/>
<path d="M29 45 Q28.5 50 29 54 Q29.5 56 29 58" stroke="url(#bloodGradient)" stroke-width="2" stroke-linecap="round" fill="none"/>
<path d="M32 48 Q31 55 32 62" stroke="url(#bloodGradient)" stroke-width="2.5" stroke-linecap="round" fill="none"/>
<path d="M35 43.5 Q35.5 47 35 50" stroke="url(#bloodGradient)" stroke-width="1.8" stroke-linecap="round" fill="none"/>
<ellipse cx="29" cy="59" rx="2" ry="2.5" fill="#dc2626"/>
<ellipse cx="32" cy="64" rx="2.5" ry="3" fill="#b91c1c"/>
<ellipse cx="35" cy="51" rx="1.8" ry="2" fill="#dc2626"/>
</svg>
</div>
<div>
<h1 class="title-text">
<span class="title-eagle">EAGLE</span>
<span class="title-fang">FANG</span>
<span class="title-bjj">BJJ</span>
</h1>
<p class="subtitle">Training Log System</p>
</div>
</div>
<div class="nav-btns">
<button class="nav-btn active" id="navNew" onclick="showView('new')">NEW ENTRY</button>
<button class="nav-btn" id="navHistory" onclick="showView('history')">HISTORY (<span id="entryCount">0</span>)</button>
</div>
</div>
</header>

<main>
<!-- NEW ENTRY VIEW -->
<div id="viewNew" class="fade-in">
<!-- Edit Banner -->
<div id="editBanner" class="edit-banner hidden">
<span id="editBannerText">‚úèÔ∏è EDITING ENTRY</span>
<button onclick="clearForm()">CANCEL EDIT</button>
</div>

```
<div class="two-col">
<div class="card" style="margin-bottom:0">
<label class="card-label">üìÖ DATE</label>
<input type="date" id="entryDate">
</div>
<div class="card" style="margin-bottom:0">
<label class="card-label">ü•ã INSTRUCTOR</label>
<input type="text" id="entryInstructor" placeholder="Enter instructor name...">
</div>
</div>

<div class="card">
<label class="card-label">üî• TECHNIQUE COVERED</label>
<input type="text" id="entryTechnique" placeholder="e.g., Armbar from guard, Triangle setup..." style="margin-bottom:16px">
<div class="notes-inner">
<label class="card-label-sm">üìù TECHNIQUE NOTES</label>
<textarea id="entryTechniqueNotes" rows="4" placeholder="Key details, tips, common mistakes to avoid..."></textarea>
</div>
</div>

<div class="card">
<label class="card-label">‚öîÔ∏è TRAINING ROUNDS (1-10)</label>
<div id="roundsContainer"></div>
</div>

<div class="card">
<label class="card-label">üì∏ PHOTO</label>
<div id="photoUploadArea">
<label class="photo-upload" id="photoUploadLabel">
<span class="icon">üì∑</span>
<span class="text">Click to upload a photo</span>
<input type="file" accept="image/*" id="photoInput" style="display:none" onchange="handlePhoto(event)">
</label>
</div>
<div id="photoPreviewArea" class="photo-preview hidden">
<img id="photoPreviewImg" alt="Training session">
<button class="photo-remove" onclick="removePhoto()">‚úï</button>
</div>
</div>

<div class="btn-row">
<button class="btn-save" id="saveBtn" onclick="saveEntry()">üíæ SAVE ENTRY</button>
<button class="btn-clear" onclick="clearForm()">üóëÔ∏è CLEAR</button>
</div>
```

</div>

<!-- HISTORY VIEW -->

<div id="viewHistory" class="fade-in hidden">
<h2 class="history-title">üìú TRAINING HISTORY</h2>
<div id="historyList"></div>
</div>

<!-- VIEW DETAIL -->

<div id="viewDetail" class="fade-in hidden">
<div class="view-header-row">
<button class="btn-back" onclick="showView('history')">‚Üê BACK TO HISTORY</button>
<button class="btn-edit-entry" id="editFromViewBtn" onclick="editFromView()">‚úèÔ∏è EDIT THIS ENTRY</button>
</div>
<div class="view-card" id="viewDetailContent"></div>
</div>
</main>

<script>
// State
let entries = [];
let editingEntryId = null;
let expandedRounds = new Set([1]);
let currentPhoto = null;
let viewingEntryId = null;

// Init
document.addEventListener('DOMContentLoaded', () => {
const saved = localStorage.getItem('eaglefang-bjj-entries');
if (saved) entries = JSON.parse(saved);
updateEntryCount();
setTodayDate();
buildRounds();
});

function setTodayDate() {
const today = new Date();
const yyyy = today.getFullYear();
const mm = String(today.getMonth() + 1).padStart(2, '0');
const dd = String(today.getDate()).padStart(2, '0');
document.getElementById('entryDate').value = `${yyyy}-${mm}-${dd}`;
}

function updateEntryCount() {
document.getElementById('entryCount').textContent = entries.length;
}

function saveToStorage() {
localStorage.setItem('eaglefang-bjj-entries', JSON.stringify(entries));
}

// Fixed date formatting ‚Äî avoids UTC timezone shift
function formatDate(dateString) {
const [year, month, day] = dateString.split('-').map(Number);
const date = new Date(year, month - 1, day);
return date.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
}

// Views
function showView(view) {
document.getElementById('viewNew').classList.toggle('hidden', view !== 'new');
document.getElementById('viewHistory').classList.toggle('hidden', view !== 'history');
document.getElementById('viewDetail').classList.toggle('hidden', view !== 'detail');
document.getElementById('navNew').classList.toggle('active', view === 'new');
document.getElementById('navHistory').classList.toggle('active', view === 'history' || view === 'detail');

if (view === 'new' && !editingEntryId) clearForm();
if (view === 'history') renderHistory();
}

// Rounds
function buildRounds() {
const container = document.getElementById('roundsContainer');
container.innerHTML = '';
for (let i = 1; i <= 10; i++) {
const isExpanded = expandedRounds.has(i);
const partnerVal = document.querySelector(`#roundPartner${i}`)?.value || '';
const notesVal = document.querySelector(`#roundNotes${i}`)?.value || '';
const hasFill = partnerVal || notesVal;

const div = document.createElement('div');
div.className = `round-item${isExpanded ? ' expanded' : ''}`;
div.id = `roundItem${i}`;
div.innerHTML = `
<button class="round-header" onclick="toggleRound(${i})">
<div style="display:flex;align-items:center">
<span class="round-num${hasFill ? ' filled' : ''}" id="roundNum${i}">${i}</span>
<span class="round-label">ROUND ${i}</span>
<span class="round-partner" id="roundPartnerDisplay${i}">${partnerVal ? 'vs ' + partnerVal : ''}</span>
</div>
<span class="round-arrow${isExpanded ? ' open' : ''}" id="roundArrow${i}">‚ñº</span>
</button>
<div class="round-body" id="roundBody${i}" ${isExpanded ? '' : 'style="display:none"'}>
<div>
<label class="card-label-sm">ü§ù TRAINING PARTNER</label>
<input type="text" id="roundPartner${i}" placeholder="Partner's name..." value="${escapeHtml(partnerVal)}" oninput="updateRoundDisplay(${i})">
</div>
<div>
<label class="card-label-sm">üìù ROUND NOTES</label>
<textarea id="roundNotes${i}" rows="3" placeholder="What happened? Submissions, positions, things to work on...">${escapeHtml(notesVal)}</textarea>

```
</div>
</div>
`;
container.appendChild(div);
```

}
}

function toggleRound(num) {
if (expandedRounds.has(num)) expandedRounds.delete(num);
else expandedRounds.add(num);

const body = document.getElementById(`roundBody${num}`);
const arrow = document.getElementById(`roundArrow${num}`);
const item = document.getElementById(`roundItem${num}`);

if (expandedRounds.has(num)) {
body.style.display = ‚Äò‚Äô;
arrow.classList.add(‚Äòopen‚Äô);
item.classList.add(‚Äòexpanded‚Äô);
} else {
body.style.display = ‚Äònone‚Äô;
arrow.classList.remove(‚Äòopen‚Äô);
item.classList.remove(‚Äòexpanded‚Äô);
}
}

function updateRoundDisplay(num) {
const val = document.getElementById(`roundPartner${num}`).value;
document.getElementById(`roundPartnerDisplay${num}`).textContent = val ? `vs ${val}` : ‚Äò‚Äô;
const notes = document.getElementById(`roundNotes${num}`).value;
const numEl = document.getElementById(`roundNum${num}`);
if (val || notes) numEl.classList.add(‚Äòfilled‚Äô);
else numEl.classList.remove(‚Äòfilled‚Äô);
}

// Photo
function handlePhoto(e) {
const file = e.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onloadend = () => {
currentPhoto = reader.result;
document.getElementById(‚ÄòphotoPreviewImg‚Äô).src = currentPhoto;
document.getElementById(‚ÄòphotoUploadArea‚Äô).classList.add(‚Äòhidden‚Äô);
document.getElementById(‚ÄòphotoPreviewArea‚Äô).classList.remove(‚Äòhidden‚Äô);
};
reader.readAsDataURL(file);
}

function removePhoto() {
currentPhoto = null;
document.getElementById(‚ÄòphotoInput‚Äô).value = ‚Äò‚Äô;
document.getElementById(‚ÄòphotoUploadArea‚Äô).classList.remove(‚Äòhidden‚Äô);
document.getElementById(‚ÄòphotoPreviewArea‚Äô).classList.add(‚Äòhidden‚Äô);
}

// Save
function saveEntry() {
const rounds = [];
for (let i = 1; i <= 10; i++) {
rounds.push({
roundNumber: i,
partnerName: document.getElementById(`roundPartner${i}`).value,
notes: document.getElementById(`roundNotes${i}`).value
});
}

const entry = {
id: editingEntryId || Date.now(),
date: document.getElementById(‚ÄòentryDate‚Äô).value,
instructor: document.getElementById(‚ÄòentryInstructor‚Äô).value,
techniqueCovered: document.getElementById(‚ÄòentryTechnique‚Äô).value,
techniqueNotes: document.getElementById(‚ÄòentryTechniqueNotes‚Äô).value,
rounds,
photo: currentPhoto,
savedAt: new Date().toISOString()
};

if (editingEntryId) {
const idx = entries.findIndex(e => e.id === editingEntryId);
if (idx !== -1) entries[idx] = entry;
} else {
entries.push(entry);
}

saveToStorage();
updateEntryCount();
clearForm();
}

// Clear
function clearForm() {
editingEntryId = null;
setTodayDate();
document.getElementById(‚ÄòentryInstructor‚Äô).value = ‚Äò‚Äô;
document.getElementById(‚ÄòentryTechnique‚Äô).value = ‚Äò‚Äô;
document.getElementById(‚ÄòentryTechniqueNotes‚Äô).value = ‚Äò‚Äô;
removePhoto();
expandedRounds = new Set([1]);

// Clear round inputs then rebuild
for (let i = 1; i <= 10; i++) {
const p = document.getElementById(`roundPartner${i}`);
const n = document.getElementById(`roundNotes${i}`);
if (p) p.value = ‚Äò‚Äô;
if (n) n.value = ‚Äò‚Äô;
}
buildRounds();

document.getElementById(‚ÄòeditBanner‚Äô).classList.add(‚Äòhidden‚Äô);
document.getElementById(‚ÄòsaveBtn‚Äô).textContent = ‚Äòüíæ SAVE ENTRY‚Äô;
document.getElementById(‚ÄòsaveBtn‚Äô).classList.remove(‚Äòediting‚Äô);
}

// History
function renderHistory() {
const list = document.getElementById(‚ÄòhistoryList‚Äô);
if (entries.length === 0) {
list.innerHTML = `<div class="empty-state"><span class="icon">ü•ã</span><p>No training sessions logged yet. Start your journey!</p></div>`;
return;
}

list.innerHTML = [‚Ä¶entries].reverse().map(entry => {
const activeRounds = entry.rounds.filter(r => r.partnerName || r.notes).length;
return `<div class="history-card"> <div class="info"> <div class="date-text">${formatDate(entry.date)}</div> <div class="meta"> <span class="label">Instructor:</span> ${escapeHtml(entry.instructor) || 'Not specified'} <span class="sep">|</span> <span class="label">Technique:</span> ${escapeHtml(entry.techniqueCovered) || 'Not specified'} <span class="sep">|</span> <span class="label">Rounds:</span> ${activeRounds} </div> </div> <div class="actions"> <button class="btn-view" onclick="viewDetail(${entry.id})">üëÅÔ∏è VIEW</button> <button class="btn-edit" onclick="editEntry(${entry.id})">‚úèÔ∏è EDIT</button> <button class="btn-delete" onclick="deleteEntry(${entry.id})">üóëÔ∏è DELETE</button> </div> </div>`;
}).join(‚Äô‚Äô);
}

function viewDetail(id) {
const entry = entries.find(e => e.id === id);
if (!entry) return;
viewingEntryId = id;

const activeRounds = entry.rounds.filter(r => r.partnerName || r.notes);
const roundsHtml = activeRounds.length > 0
? activeRounds.map(r => `<div class="view-round"> <div class="view-round-header"> <span class="view-round-num">${r.roundNumber}</span> <span class="view-round-partner">${r.partnerName ?`vs ${escapeHtml(r.partnerName)}`:`Round ${r.roundNumber}`}</span> </div> ${r.notes ? `<p class="view-round-notes">${escapeHtml(r.notes)}</p>`: ''} </div>`).join(‚Äô‚Äô)
: `<p style="color:#6b7280;font-family:Arial,sans-serif">No rounds logged for this session.</p>`;

document.getElementById(‚ÄòviewDetailContent‚Äô).innerHTML = `<h2 class="view-date">${formatDate(entry.date)}</h2> <div class="view-grid"> <div> <span class="view-field-label">INSTRUCTOR</span> <p class="view-field-value">${escapeHtml(entry.instructor) || '‚Äî'}</p> </div> <div> <span class="view-field-label">TECHNIQUE COVERED</span> <p class="view-field-value">${escapeHtml(entry.techniqueCovered) || '‚Äî'}</p> </div> </div> ${entry.techniqueNotes ?`
<div style="margin-bottom:32px">
<span class="view-section-label">üìù TECHNIQUE NOTES</span>
<p class="view-notes-block">${escapeHtml(entry.techniqueNotes)}</p>
</div>
`: ''} ${entry.photo ?`
<div style="margin-bottom:32px">
<span class="view-section-label">üì∏ PHOTO</span>
<img src="${entry.photo}" alt="Training session" style="width:100%;max-height:400px;object-fit:cover;border-radius:12px;margin-top:12px">
</div>
`: ''} <div> <span class="view-section-label">‚öîÔ∏è TRAINING ROUNDS</span> <div style="margin-top:16px">${roundsHtml}</div> </div>`;

showView(‚Äòdetail‚Äô);
}

function editEntry(id) {
const entry = entries.find(e => e.id === id);
if (!entry) return;

editingEntryId = entry.id;
document.getElementById(‚ÄòentryDate‚Äô).value = entry.date;
document.getElementById(‚ÄòentryInstructor‚Äô).value = entry.instructor;
document.getElementById(‚ÄòentryTechnique‚Äô).value = entry.techniqueCovered;
document.getElementById(‚ÄòentryTechniqueNotes‚Äô).value = entry.techniqueNotes;

if (entry.photo) {
currentPhoto = entry.photo;
document.getElementById(‚ÄòphotoPreviewImg‚Äô).src = currentPhoto;
document.getElementById(‚ÄòphotoUploadArea‚Äô).classList.add(‚Äòhidden‚Äô);
document.getElementById(‚ÄòphotoPreviewArea‚Äô).classList.remove(‚Äòhidden‚Äô);
} else {
removePhoto();
}

// Set round values
expandedRounds = new Set();
for (let i = 1; i <= 10; i++) {
const round = entry.rounds[i - 1];
const pEl = document.getElementById(`roundPartner${i}`);
const nEl = document.getElementById(`roundNotes${i}`);
if (pEl) pEl.value = round ? round.partnerName : ‚Äò‚Äô;
if (nEl) nEl.value = round ? round.notes : ‚Äò‚Äô;
if (round && (round.partnerName || round.notes)) expandedRounds.add(i);
}
if (expandedRounds.size === 0) expandedRounds.add(1);
buildRounds();

// Re-set values after rebuild
for (let i = 1; i <= 10; i++) {
const round = entry.rounds[i - 1];
if (round) {
document.getElementById(`roundPartner${i}`).value = round.partnerName;
document.getElementById(`roundNotes${i}`).value = round.notes;
updateRoundDisplay(i);
}
}

document.getElementById(‚ÄòeditBanner‚Äô).classList.remove(‚Äòhidden‚Äô);
document.getElementById(‚ÄòeditBannerText‚Äô).textContent = `‚úèÔ∏è EDITING ENTRY ‚Äî ${formatDate(entry.date)}`;
document.getElementById(‚ÄòsaveBtn‚Äô).textContent = ‚Äò‚úèÔ∏è UPDATE ENTRY‚Äô;
document.getElementById(‚ÄòsaveBtn‚Äô).classList.add(‚Äòediting‚Äô);

showView(‚Äònew‚Äô);
window.scrollTo({ top: 0, behavior: ‚Äòsmooth‚Äô });
}

function editFromView() {
if (viewingEntryId) editEntry(viewingEntryId);
}

function deleteEntry(id) {
if (!confirm(‚ÄòDelete this training session?‚Äô)) return;
entries = entries.filter(e => e.id !== id);
saveToStorage();
updateEntryCount();
if (viewingEntryId === id) showView(‚Äòhistory‚Äô);
else renderHistory();
}

function escapeHtml(str) {
if (!str) return ‚Äò‚Äô;
const div = document.createElement(‚Äòdiv‚Äô);
div.textContent = str;
return div.innerHTML;
}
</script>

</body>
</html>
